---
title: "Interpolation test"
author: "Dmitry Zotikov"
date: "April 10, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
source('pois_hmm.R')
source('import_earthquakes.R')
set.seed(1)
xx <- earthquakes.zuc.annual$count
hmm <- PoisHmm(3, xx)
hmm$fit(xx)
plot(xx, type='o')
```

Point probability of $\xi_{t_0} = 5$ at $t_0 = 4$ (given a sample with $x_{t_0}$ missing).

```{r}
hmm$interpolateDist(xx, 5, 4)
```

Distribution of $\xi_{t_0}, t_0 = 4$ (with $x_{t_0}$ missing).

```{r}
# x.probes <- sort(unique(xx))
x.probes <- 0:50
dd <- hmm$interpolateDist(xx, x.probes, 5)
barplot(dd)
sum(dd)
```

Distribution of $\xi_{t_0}$ for $t_0 \in \{1, 3, \dots, 11 \}$ (with $x_{t_0}$ missing).

```{r}
D <- hmm$interpolateDist(xx, x.probes, seq(1,12,by=2))
matplot(t(D), type='b', pch=1:6)
```

Distribution of $\xi_{t_0}$ for $t_0 \in \{1, \dots, 16 \}$ (with $x_{t_0}$ missing).

```{r, fig.height=9, fig.width=9}
D <- hmm$interpolateDist(xx, x.probes, 1:16)
source('util_plot.R')
plotForecastDist(D, xx, x.probes, 1:16, xx.true=xx)
```



```{r}
source('util_test.R')
res <- testIntepolation(hmm, xx, x.probes, t.probes)
```

Не всегда истинное значение совпадало с одной из характеристик положения; тем не менее, было оно довольно "близко".  Предположительно, при уменьшении алфавита, точность возрастет.

```{r}
head(res)
```

Точное угадывание хотя бы одной характеристикой:

```{r}
correct <- subset(res, (res[,'d.mode'] == 0) | (res[,'d.mean'] == 0) | (res[,'d.median'] == 0))
correct
```

 # точных угадываний:

```{r}
nrow(correct)
```

% точных угдаываний:

```{r}
nrow(correct) / length(xx)
```

% точных угдаываний по каждой характеристике:

```{r}
for (i in 1:3) {
  cat(colnames(res)[1+i], ':', nrow(subset(res, res[, 4+i] == 0)) / length(xx), '\n')
}
```

